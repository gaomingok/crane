<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<title>吊臂计算</title> 
</head>
<body>
<h2 align="center">吊臂计算</h2>
<canvas id="myCanvas" width="100" height="100" style="border:1px solid #d3d3d3;">
您的浏览器不支持 HTML5 canvas 标签。</canvas>
<img id="imgCrane" src="crane.jpg" width="40" height="20" style="display:none;">
<p>
<table>
<tr>
<td>车高: </td><td><input id="inputCarHeight" type="text" style="width: 30px;" value="1.5"></input>米</td>
<td>距离: </td><td><input id="inputDist" type="text"style="width: 30px;"  value="20"></input>米</td>
<td>高度: </td><td><input id="inputHeight" type="text"style="width: 30px;"  value="10"></input>米</td>
</tr>
<tr>
<td>臂长: </td><td><label id="armLength" style="color:blue; font-weight:bold;"></td>
<td>夹角: </td><td><label id="angle" style="color:blue; font-weight:bold;"></td>
<td /><td />
</tr>
<tr />
<tr>
<td /><td />
<td><button style="border:1px solid #d3d3d3; width: 50px; font-weight:bold;" type="button" onclick="draw()">计  算</button></td>
</tr>
</table>

<script>
var CANVAS_MAX_HEIGHT=300;   //画布大小
var CANVAS_MARGIN=8;  //画布边距
var TEXT_TO_LINE_DIST=10;  //文字离线的距离
var canvas=document.getElementById("myCanvas");
canvas.height=CANVAS_MAX_HEIGHT;
canvas.width=CANVAS_MAX_HEIGHT+50;
var img=document.getElementById("imgCrane");
var ctx=canvas.getContext("2d");
img.onload = function()
{
    ctx.drawImage(img,0,CANVAS_MAX_HEIGHT-20,40,20);
}

function draw() {
//获取对象
var canvas=document.getElementById("myCanvas");
var ctx=canvas.getContext("2d");
var carHeight=document.getElementById("inputCarHeight");
var distance=document.getElementById("inputDist");
var height=document.getElementById("inputHeight");
var img=document.getElementById("imgCrane");

//清空
document.getElementById("armLength").innerHTML ="";
canvas.height=canvas.height;
//坐标
var ax=CANVAS_MARGIN;
var ay=CANVAS_MAX_HEIGHT-scale(carHeight.value)
var bx=scale(distance.value);
var by=ay;
var by1=by+scale(carHeight.value);
var cx=bx;
var cy=CANVAS_MAX_HEIGHT-scale(height.value);
var a=distance.value;
var b=height.value-carHeight.value;
var c=Math.sqrt(a*a+b*b);
var angle=Math.acos(a/c)*180/Math.PI;
document.getElementById("armLength").innerHTML = c.toFixed(2) + " 米";
document.getElementById("angle").innerHTML = angle.toFixed(2) + "°";

//画车
var imgHeght = scale(carHeight.value)*1.5;
ctx.drawImage(img,0,CANVAS_MAX_HEIGHT-imgHeght,2*imgHeght,imgHeght);

//起始点
ctx.beginPath();
ctx.arc(ax,ay,CANVAS_MARGIN,0,Math.PI*2,true);
ctx.closePath();
ctx.fillStyle = 'green';
ctx.fill();
ctx.stroke();

//画a、b边
ctx.lineWidth=1;
ctx.strokeStyle = "green";
ctx.moveTo(ax,ay);
ctx.lineTo(bx,by);
ctx.moveTo(bx,by1);
ctx.lineTo(cx,cy);
ctx.stroke();

//距离标注
ctx.fillText(distance.value+"米", (bx-ax)/2, ay+TEXT_TO_LINE_DIST);
//高度标注
ctx.fillText(height.value+"米", (bx+TEXT_TO_LINE_DIST), cy+(by1-cy)/2+TEXT_TO_LINE_DIST);

//画吊臂
ctx.lineWidth=5;
ctx.strokeStyle = "blue";
ctx.beginPath();
ctx.moveTo(cx,cy);
ctx.lineTo(ax,ay);
ctx.stroke();
//吊臂标注
ctx.fillText(c.toFixed(2)+"米", (cx-ax)/2-4*TEXT_TO_LINE_DIST, cy+(ay-cy)/2);

}

function showText(ctx,x1,y1,x2,y2,text) {
	
}

function scale(x) {
	return x*10;
}
</script>

</body>
</html>